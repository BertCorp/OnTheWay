<% if ENV['INTERCOM_APP_ID'] %>
<%
  options = { :app_id => ENV['INTERCOM_APP_ID'] }
  if current_company
    options[:user_id] = "company::#{current_company.id}"
    options[:email] = current_company.email
    options[:created_at] = current_company.created_at.to_i
    options[:name] = current_company.name
    options[:custom_data] = {
      "type" => 'company',
      "providers" => current_company.providers.count,
      "total_appointments" => current_company.appointments.count,
      "finished_appointments" => current_company.appointments.where(:status => 'finished').count
    }
  elsif current_provider
    options[:user_id] = "provider::#{current_provider.id}"
    options[:email] = current_provider.email
    options[:created_at] = current_provider.created_at.to_i
    options[:name] = current_provider.name
    options[:custom_data] = {
      "type" => "provider",
      "total_appointments" => current_provider.appointments.count,
      "finished_appointments" => current_provider.appointments.where(:status => 'finished').count,
      :company => {
        :id => "company::#{current_provider.company.id}",
        :name => current_provider.company.name,
        :created_at => current_provider.company.created_at.to_i,
        "providers" => current_provider.company.providers.count,
        "total_appointments" => current_provider.company.appointments.count,
        "finished_appointments" => current_provider.company.appointments.where(:status => 'finished').count
      }
    }
  end
%>
<%= intercom_script_tag(options) %>
<% end %>
