<%= simple_form_for(@appointment, :html => { :class => 'form-horizontal' }) do |f| %>
  <% if @appointment.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@appointment.errors.count, "error") %> prohibited this appointment from being saved:</h2>

      <ul>
      <% @appointment.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <%= f.hidden_field :company_id, :value => current_company.id %>

  <div class="control-group">
    <label class="control-label" for="appointment_customer">Customer</label>
    <div class="controls">
      <% if @appointment.customer %>
      <%= f.select :customer_id, current_company.customers.collect {|a| [a.name, a.id]} -%>
      <% else %>
        <%= f.fields_for :customer do |customer| %>
          <%= customer.text_field :name, placeholder: 'Name', style: "margin-bottom: 5px;" %><br/>
          <%= customer.email_field :email, placeholder: 'ex: example@onthewayhq.com', style: "margin-bottom: 5px;" %><br/>
          <%= customer.telephone_field :phone, placeholder: '123-456-7890', pattern: "[0-9]{3}[\-][0-9]{3}[\-][0-9]{4}", class: 'input-medium', maxlength: '12' %>
        <% end %>
      <% end %>
    </div>
  </div>

  <div class="control-group string optional appointment_starts_at">
    <label class="string optional control-label" for="appointment_starts_at">When</label>
    <div class="controls">
      <input id="appointment_starts_at" name="appointment[starts_at][date]" class="input-medium" type="date" value="<%= (@appointment.starts_at||Date.today).strftime("%F") %>" />
      <input class="input-small" type="time" name="appointment[starts_at][time]" value="<%= @appointment.starts_at.strftime("%H:%M:%S") if @appointment.starts_at && @appointment.starts_at.strftime("%H:%M:%S") != "00:00:00" %>" style="width: 102px;" />
      <!--<span class="help-block">All times are shown as Central Standard Time (GMT -06:00).</span>-->
    </div>
  </div>

  <div class="control-group">
    <label class="control-label" for="appointment_location">Where</label>
    <div class="controls">
      <%= f.text_area :location, :class => 'input-xlarge', :rows => "3" %>
    </div>
  </div>

  <div class="control-group">
    <label class="control-label" for="appointment_provider">Provider</label>
    <div class="controls">
      <%= f.select :provider_id, current_company.providers.collect {|a| [a.name, a.id]}, :include_blank => true -%>
    </div>
  </div>

  <div class="control-group">
    <label class="control-label" for="appointment_notes">Notes</label>
    <div class="controls">
      <%= f.text_area :notes, :class => 'input-xlarge', :rows => "3" %>
    </div>
  </div>

  <div class="control-group">
    <label class="control-label" for="appointment_status">Status</label>
    <div class="controls">
      <%= f.select :status, @appointment.statuses, :include_blank => true %>
    </div>
  </div>

  <% if @appointment.confirmed_at %>
  <div class="control-group string optional appointment_confirmed_at">
    <label class="string optional control-label" for="appointment_confirmed_at">Confirmed At</label>
    <div class="controls">
      <input id="appointment_confirmed_at" name="appointment[confirmed_at]" class="input-large" type="text" value="<%= @appointment.confirmed_at %>" />
    </div>
  </div>
  <% end %>
  <% if @appointment.en_route_at %>
  <div class="control-group string optional appointment_en_route_at">
    <label class="string optional control-label" for="appointment_en_route_at">En Route At</label>
    <div class="controls">
      <input id="appointment_en_route_at" name="appointment[en_route_at]" class="input-large" type="text" value="<%= @appointment.en_route_at %>" />
    </div>
  </div>
  <% end %>
  <% if @appointment.arrived_at %>
  <div class="control-group string optional appointment_arrived_at">
    <label class="string optional control-label" for="appointment_arrived_at">Arrived At</label>
    <div class="controls">
      <input id="appointment_arrived_at" name="appointment[arrived_at]" class="input-large" type="text" value="<%= @appointment.arrived_at %>" />
    </div>
  </div>
  <% end %>
  <% if @appointment.finished_at %>
  <div class="control-group string optional appointment_finished_at">
    <label class="string optional control-label" for="appointment_finished_at">Finished At</label>
    <div class="controls">
      <input id="appointment_finished_at" name="appointment[finished_at]" class="input-large" type="text" value="<%= @appointment.finished_at %>" />
    </div>
  </div>
  <% end %>

  <div class="form-actions">
    <%= f.button :submit, :class => 'btn-primary' %>
    <%= link_to 'Cancel', :back, :class => "btn btn-danger" %>
  </div>
<% end %>

<script>

  $("select").chosen();

</script>
