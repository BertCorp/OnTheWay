
<h3>Current Location:</h3>

<div id="mapContainer" style="width: 100%; height: 500px; margin: auto;"></div>

<!--<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>-->
<script src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript">

  var marker = null;
  var map = null;
  if (navigator.geolocation) {
    navigator.geolocation.watchPosition(function(position){
      console.log(position.coords);
      // lets store in redis.
      $.post('/providers/track', { position: position }, function(data) {
        console.log("Stored: " + data);
      });

      var latitude = position.coords.latitude;
      var longitude = position.coords.longitude;
      var coords = new google.maps.LatLng(latitude, longitude);
      var mapOptions = {
        zoom: 15,
        center: coords,
        mapTypeControl: true,
        mapTypeId: google.maps.MapTypeId.ROADMAP
      };
      if (marker) {
        marker.setPosition(coords);
      } else {
        map = new google.maps.Map(document.getElementById("mapContainer"), mapOptions);
        marker = new google.maps.Marker({
          icon : { url : 'http://i.stack.imgur.com/orZ4x.png', size: new google.maps.Size(22, 22), origin: new google.maps.Point(0, 0), anchor: new google.maps.Point(11,11) },
          position: coords,
          map: map,
          title: "Your current location!"
        });
      }
    }, function(err) {
      alert("Uhoh! We had an error.");
    }, { enableHighAccuracy : true, timeout : 60000, maximumAge : 0 });
  } else {
    alert("Geolocation API is not supported in your browser.");
  }

</script>
